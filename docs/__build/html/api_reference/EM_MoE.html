

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Module EM_MoE.py &#8212; mlgw 3.0.0 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'api_reference/EM_MoE';</script>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Module ML_routines.py" href="ML_routines.html" />
    <link rel="prev" title="Module NN_model.py" href="NN_model.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    <p class="title logo__title">mlgw 3.0.0 documentation</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Usage</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../usage/install.html">Installing <code class="docutils literal notranslate"><span class="pre">mlgw</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/overview.html">What <code class="docutils literal notranslate"><span class="pre">mlgw</span></code> can do for you</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">API reference</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="GW_generator.html">Module GW_generator.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="NN_model.html">Module NN_model.py</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Module EM_MoE.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="ML_routines.html">Module ML_routines.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="GW_helper.html">Module GW_helper.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="fit_model.html">Module fit_model.py</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">About</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../about.html">About</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/api_reference/EM_MoE.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>

</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Module EM_MoE.py</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <span class="target" id="module-mlgw.EM_MoE"></span><section id="module-em-moe-py">
<h1>Module EM_MoE.py<a class="headerlink" href="#module-em-moe-py" title="Permalink to this heading">#</a></h1>
<blockquote>
<div><dl class="simple">
<dt>Definition of the following ML models useful for developing a full MoE model:</dt><dd><dl class="simple">
<dt>Mixture of Experts model</dt><dd><p>class MoE_model: implements a MoE model with methods for fitting and making predictions</p>
</dd>
<dt>Softmax regression</dt><dd><p>class softmax_regression: implements a softmax regression with methods for fitting and making predictions. This is the standard classifier used by MoE model.</p>
</dd>
</dl>
</dd>
</dl>
</div></blockquote>
</section>
<dl class="py class">
<dt class="sig sig-object py" id="mlgw.EM_MoE.MoE_model">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">MoE_model</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">D</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">K</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gating_function</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">bias</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">True</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mlgw/EM_MoE.html#MoE_model"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlgw.EM_MoE.MoE_model" title="Permalink to this definition">#</a></dt>
<dd><p>where S(x_i) is any model. A default for S(x_i) is the softmax model S(x_i)= softmax(V*x_i).
The model is fitted trough EM algorithm.</p>
<p>Initialize the model.
The gating function must be specified through an object with methods:</p>
<blockquote>
<div><p>fit(x_train(N,D)                labels_train (N,K)) returning
predict((x_test(N,D)))  returning labels_predicted (N,K)
save                                    for saving to file the entire model
load                                    to load from file the entire model</p>
</div></blockquote>
<p>Gating function must use cross entropy loss function.
If None a default softmax regression model is used built from class softmax_regression.
The gating function obkect must be already initialized properly.
Input:</p>
<blockquote>
<div><p>D                                               dimensionality of input space
K                                               number of experts for the model
gating_function (obj)   an object which represents the gating function
bias                                    whether to use a bias in the expert model</p>
</div></blockquote>
<dl class="py method">
<dt class="sig sig-object py" id="mlgw.EM_MoE.MoE_model.EM_step">
<span class="sig-name descname"><span class="pre">EM_step</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">r</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">args</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mlgw/EM_MoE.html#MoE_model.EM_step"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlgw.EM_MoE.MoE_model.EM_step" title="Permalink to this definition">#</a></dt>
<dd><blockquote>
<div><p>X (N,D) train data
y (N,)  train targets for regression
r (N,K) responsibilities for the E step (if None they are computed with method get_responsibilities)
args    some arguments to pass to fit method of gating function</p>
</div></blockquote>
<dl class="simple">
<dt>Output:</dt><dd><p>gat_history             history for the gating function fit</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mlgw.EM_MoE.MoE_model.expert_likelihood">
<span class="sig-name descname"><span class="pre">expert_likelihood</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mlgw/EM_MoE.html#MoE_model.expert_likelihood"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlgw.EM_MoE.MoE_model.expert_likelihood" title="Permalink to this definition">#</a></dt>
<dd><blockquote>
<div><p>X (N,D) data
y (N,)  targets</p>
</div></blockquote>
<dl class="simple">
<dt>Output:</dt><dd><p>pi_k (N,K)      N(y_i| &lt;w_k,x_i&gt;)</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mlgw.EM_MoE.MoE_model.experts_predictions">
<span class="sig-name descname"><span class="pre">experts_predictions</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mlgw/EM_MoE.html#MoE_model.experts_predictions"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlgw.EM_MoE.MoE_model.experts_predictions" title="Permalink to this definition">#</a></dt>
<dd><blockquote>
<div><p>X_test (N,D)    test points</p>
</div></blockquote>
<dl class="simple">
<dt>Output:</dt><dd><p>y_test (N,K)    experts predictions</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mlgw.EM_MoE.MoE_model.fit">
<span class="sig-name descname"><span class="pre">fit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N_iter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.01</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">args</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">[]</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">val_set</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">pick_best</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mlgw/EM_MoE.html#MoE_model.fit"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlgw.EM_MoE.MoE_model.fit" title="Permalink to this definition">#</a></dt>
<dd><p>===
Fit the model using EM algorithm.
Input:</p>
<blockquote>
<div><p>X_train (N,D)   train data
y_train (N,)    train targets for regression
N_iter                  Maximum number of iteration (if None only threshold is applied)
threshold               Minimum change in LL below which algorithm is terminated
args                    arguments to be given to fit method of gating function
verbose                 whether to print values during fit
val_set                 tuple (X_val, y_val) with a validation set to test performances
pick_best               if True the model with best validation mse is chosen as best model (doesn’t apply if val_set is None)</p>
</div></blockquote>
<dl class="simple">
<dt>Output:</dt><dd><p>history         list of value for the LL of the model at every epoch</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mlgw.EM_MoE.MoE_model.get_gating_probs">
<span class="sig-name descname"><span class="pre">get_gating_probs</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mlgw/EM_MoE.html#MoE_model.get_gating_probs"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlgw.EM_MoE.MoE_model.get_gating_probs" title="Permalink to this definition">#</a></dt>
<dd><blockquote>
<div><p>X (N,D) data points</p>
</div></blockquote>
<dl class="simple">
<dt>Output:</dt><dd><p>p_gating (N,K)  probabilities of each gating function</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mlgw.EM_MoE.MoE_model.get_gradient">
<span class="sig-name descname"><span class="pre">get_gradient</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mlgw/EM_MoE.html#MoE_model.get_gradient"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlgw.EM_MoE.MoE_model.get_gradient" title="Permalink to this definition">#</a></dt>
<dd><p>where grad has shape (D,) and D_i denotes the partial derivative w.r.t. x_i.
Input:</p>
<blockquote>
<div><p>X (N,D)</p>
</div></blockquote>
<dl class="simple">
<dt>Output:</dt><dd><p>grad (N,D)</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mlgw.EM_MoE.MoE_model.get_iperparams">
<span class="sig-name descname"><span class="pre">get_iperparams</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mlgw/EM_MoE.html#MoE_model.get_iperparams"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlgw.EM_MoE.MoE_model.get_iperparams" title="Permalink to this definition">#</a></dt>
<dd><blockquote>
<div><p>(D,K)   (dimensionality of input space, number of experts)</p>
</div></blockquote>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mlgw.EM_MoE.MoE_model.get_responsibilities">
<span class="sig-name descname"><span class="pre">get_responsibilities</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mlgw/EM_MoE.html#MoE_model.get_responsibilities"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlgw.EM_MoE.MoE_model.get_responsibilities" title="Permalink to this definition">#</a></dt>
<dd><dl class="simple">
<dt>Input:</dt><dd><p>X (N,D) data
y (N,)  data labels</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mlgw.EM_MoE.MoE_model.load">
<span class="sig-name descname"><span class="pre">load</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">exp_file</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gat_file</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">load_function</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mlgw/EM_MoE.html#MoE_model.load"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlgw.EM_MoE.MoE_model.load" title="Permalink to this definition">#</a></dt>
<dd><blockquote>
<div><p>exp_file                file to load the expert model from
gat_file                file to load the model for gating function from (using function load_function)
gating_function function for loading the gating function model from file</p>
</div></blockquote>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mlgw.EM_MoE.MoE_model.log_likelihood">
<span class="sig-name descname"><span class="pre">log_likelihood</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mlgw/EM_MoE.html#MoE_model.log_likelihood"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlgw.EM_MoE.MoE_model.log_likelihood" title="Permalink to this definition">#</a></dt>
<dd><blockquote>
<div><p>= sum_{i=1}^N log sum_{k=1}^K N(y_i | &lt;w_k,x_i&gt;) S(x_i)_k</p>
</div></blockquote>
<dl class="simple">
<dt>Input:</dt><dd><p>X (N,D) data
y (N,)  targets for regression</p>
</dd>
<dt>Output:</dt><dd><p>LL      log-likelihood for the model</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mlgw.EM_MoE.MoE_model.predict">
<span class="sig-name descname"><span class="pre">predict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mlgw/EM_MoE.html#MoE_model.predict"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlgw.EM_MoE.MoE_model.predict" title="Permalink to this definition">#</a></dt>
<dd><blockquote>
<div><p>X (N,D) test points</p>
</div></blockquote>
<dl class="simple">
<dt>Output:</dt><dd><p>y (N,)  model value at test points</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mlgw.EM_MoE.MoE_model.save">
<span class="sig-name descname"><span class="pre">save</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">exp_file</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">gat_file</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mlgw/EM_MoE.html#MoE_model.save"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlgw.EM_MoE.MoE_model.save" title="Permalink to this definition">#</a></dt>
<dd><blockquote>
<div><p>exp_file        file to save the expert model to
gat_file        file to save the model for gating function</p>
</div></blockquote>
</dd></dl>

</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mlgw.EM_MoE.softmax_regression">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">softmax_regression</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">D</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">K</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mlgw/EM_MoE.html#softmax_regression"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlgw.EM_MoE.softmax_regression" title="Permalink to this definition">#</a></dt>
<dd><p>It has methods for getting predictions from the model and to fit the model.</p>
<section id="init">
<h1>__init__<a class="headerlink" href="#init" title="Permalink to this heading">#</a></h1>
<blockquote>
<div><p>Initialize the model with K classes for regressions.
Input:</p>
<blockquote>
<div><p>D       dimensionality of input space
K       number or classes for regression</p>
</div></blockquote>
</div></blockquote>
<dl class="py method">
<dt class="sig sig-object py" id="mlgw.EM_MoE.softmax_regression.LL">
<span class="sig-name descname"><span class="pre">LL</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_test</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mlgw/EM_MoE.html#softmax_regression.LL"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlgw.EM_MoE.softmax_regression.LL" title="Permalink to this definition">#</a></dt>
<dd><p>==
Evaluate the log-likelihood for the model given X and their labels.
Input:</p>
<blockquote>
<div><p>X_test (N,D)    test points
y_test (N,K)    labels of test points</p>
</div></blockquote>
<dl class="simple">
<dt>Output:</dt><dd><p>LL      log-likelihood for the model</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mlgw.EM_MoE.softmax_regression.accuracy">
<span class="sig-name descname"><span class="pre">accuracy</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_test</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mlgw/EM_MoE.html#softmax_regression.accuracy"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlgw.EM_MoE.softmax_regression.accuracy" title="Permalink to this definition">#</a></dt>
<dd><dl class="simple">
<dt>Input:</dt><dd><p>X_test (N,D)    test points
y_test (N,K)    true labels of test points</p>
</dd>
<dt>Output:</dt><dd><p>accuracy        accuracy of the predictions made at test points</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mlgw.EM_MoE.softmax_regression.fit">
<span class="sig-name descname"><span class="pre">fit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">opt</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">'adam'</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">val_set</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">reg_constant</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.0001</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">threshold</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.01</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N_iter</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">30</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">learning_rate</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">0.001</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mlgw/EM_MoE.html#softmax_regression.fit"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlgw.EM_MoE.softmax_regression.fit" title="Permalink to this definition">#</a></dt>
<dd><p>===
Fit the model using gradient descent.
Can use adam for adaptive step: <a class="reference external" href="https://arxiv.org/abs/1412.6980v8">https://arxiv.org/abs/1412.6980v8</a>
Can use bfgs method provided by scipy: <a class="reference external" href="https://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.fmin_bfgs.html">https://docs.scipy.org/doc/scipy/reference/generated/scipy.optimize.fmin_bfgs.html</a>
Using a small regularizer can help convergence (especially for bfgs).
Input:</p>
<blockquote>
<div><p>X_train (N,D)   train data
y_train (N,)    train targets for regression
opt                             which optimizer to use (“adam” or “bsfg”)
val_set                 tuple (X_val, y_val) with a validation set to test performances
reg_constant    regularization constants
verbose                 whether to print values of loss function at every train step
threshold               minimun improvement of validation erorr on 10 iteration before stopping (train error if val_set =None)
N_iter                  number of iteration to be performed (doesn’t apply to bfgs or if threshold is not None)
learning_rate   learning rate used for gradient update (doesn’t apply to bfgs)</p>
</div></blockquote>
<dl class="simple">
<dt>Output:</dt><dd><p>history         list of value for the loss function</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mlgw.EM_MoE.softmax_regression.fit_single_loop">
<span class="sig-name descname"><span class="pre">fit_single_loop</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X_train</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y_train</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mlgw/EM_MoE.html#softmax_regression.fit_single_loop"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlgw.EM_MoE.softmax_regression.fit_single_loop" title="Permalink to this definition">#</a></dt>
<dd><p>See: <a class="reference external" href="https://link.springer.com/content/pdf/10.1007%2F978-3-642-01510-6_109.pdf">https://link.springer.com/content/pdf/10.1007%2F978-3-642-01510-6_109.pdf</a>
Input:</p>
<blockquote>
<div><p>X_train (N,D)   train data
y_train (N,)    train targets for regression</p>
</div></blockquote>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mlgw.EM_MoE.softmax_regression.get_jacobian">
<span class="sig-name descname"><span class="pre">get_jacobian</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mlgw/EM_MoE.html#softmax_regression.get_jacobian"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlgw.EM_MoE.softmax_regression.get_jacobian" title="Permalink to this definition">#</a></dt>
<dd><p>where J has shape (K,D) and D_i denotes the partial derivative w.r.t. x_i.
Input:</p>
<blockquote>
<div><p>X (N,D)</p>
</div></blockquote>
<dl class="simple">
<dt>Output:</dt><dd><p>grad (N,K,D)</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mlgw.EM_MoE.softmax_regression.get_weights">
<span class="sig-name descname"><span class="pre">get_weights</span></span><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mlgw/EM_MoE.html#softmax_regression.get_weights"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlgw.EM_MoE.softmax_regression.get_weights" title="Permalink to this definition">#</a></dt>
<dd><dl class="simple">
<dt>Output:</dt><dd><p>V (D+1,K)       weights for the model</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mlgw.EM_MoE.softmax_regression.grad">
<span class="sig-name descname"><span class="pre">grad</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">V</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mlgw/EM_MoE.html#softmax_regression.grad"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlgw.EM_MoE.softmax_regression.grad" title="Permalink to this definition">#</a></dt>
<dd><blockquote>
<div><p>V ((D+1)*K,)    weights of logreg
data                    list [X_train (N,D), y_train (N,K), lambda ()]</p>
</div></blockquote>
<dl class="simple">
<dt>Output:</dt><dd><p>grad    value for the gradient of loss function evaluated at V</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mlgw.EM_MoE.softmax_regression.load">
<span class="sig-name descname"><span class="pre">load</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filename</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mlgw/EM_MoE.html#softmax_regression.load"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlgw.EM_MoE.softmax_regression.load" title="Permalink to this definition">#</a></dt>
<dd><blockquote>
<div><p>filename        name of the file to load the model from</p>
</div></blockquote>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mlgw.EM_MoE.softmax_regression.loss">
<span class="sig-name descname"><span class="pre">loss</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">V</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mlgw/EM_MoE.html#softmax_regression.loss"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlgw.EM_MoE.softmax_regression.loss" title="Permalink to this definition">#</a></dt>
<dd><dl class="simple">
<dt>Input:</dt><dd><p>V ((D+1)*K,)    weights of logreg
data                    list [X_train (N,D), y_train (N,K), lambda ()]</p>
</dd>
<dt>Output:</dt><dd><p>loss    value for the loss function evaluated at V</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mlgw.EM_MoE.softmax_regression.predict">
<span class="sig-name descname"><span class="pre">predict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">X_test</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">V</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mlgw/EM_MoE.html#softmax_regression.predict"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlgw.EM_MoE.softmax_regression.predict" title="Permalink to this definition">#</a></dt>
<dd><blockquote>
<div><p>X_test (N,D)/(N,)       test points
V (D+1,K)                       weight of the model that gives predictions (if None, internal weights are used)</p>
</div></blockquote>
<dl class="simple">
<dt>Output:</dt><dd><p>y_test (N,K)    model prediction</p>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mlgw.EM_MoE.softmax_regression.save">
<span class="sig-name descname"><span class="pre">save</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">filename</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mlgw/EM_MoE.html#softmax_regression.save"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlgw.EM_MoE.softmax_regression.save" title="Permalink to this definition">#</a></dt>
<dd><blockquote>
<div><p>filename        name of the file to save the model to</p>
</div></blockquote>
</dd></dl>

</section>
</dd></dl>



                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="NN_model.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Module NN_model.py</p>
      </div>
    </a>
    <a class="right-next"
       href="ML_routines.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Module ML_routines.py</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Stefano Schmidt
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2023, Stefano Schmidt.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>