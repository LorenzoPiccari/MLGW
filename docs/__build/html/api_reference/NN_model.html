

<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Module NN_model.py &#8212; mlgw 3.0.0 documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'api_reference/NN_model';</script>
    <link rel="author" title="About these documents" href="../about.html" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Module EM_MoE.py" href="EM_MoE.html" />
    <link rel="prev" title="Module GW_generator.py" href="GW_generator.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    <p class="title logo__title">mlgw 3.0.0 documentation</p>
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Usage</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../usage/install.html">Installing <code class="docutils literal notranslate"><span class="pre">mlgw</span></code></a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage/overview.html">What <code class="docutils literal notranslate"><span class="pre">mlgw</span></code> can do for you</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">API reference</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="GW_generator.html">Module GW_generator.py</a></li>
<li class="toctree-l1 current active"><a class="current reference internal" href="#">Module NN_model.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="EM_MoE.html">Module EM_MoE.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="ML_routines.html">Module ML_routines.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="GW_helper.html">Module GW_helper.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="fit_model.html">Module fit_model.py</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">About</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../about.html">About</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/api_reference/NN_model.rst" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.rst</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>


<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script>

<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>

</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Module NN_model.py</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <span class="target" id="module-mlgw.NN_model"></span><section id="module-nn-model-py">
<h1>Module NN_model.py<a class="headerlink" href="#module-nn-model-py" title="Permalink to this heading">#</a></h1>
<p>Implements a Neural Network model to generate the reduced PCA coeffiecients of a WF.</p>
</section>
<dl class="py class">
<dt class="sig sig-object py" id="mlgw.NN_model.NN_HyperModel">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">NN_HyperModel</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">output_nodes</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hyperparameter_ranges</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">loss_weights</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mlgw/NN_model.html#NN_HyperModel"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlgw.NN_model.NN_HyperModel" title="Permalink to this definition">#</a></dt>
<dd><dl class="py method">
<dt class="sig sig-object py" id="mlgw.NN_model.NN_HyperModel.build">
<span class="sig-name descname"><span class="pre">build</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">hp</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mlgw/NN_model.html#NN_HyperModel.build"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlgw.NN_model.NN_HyperModel.build" title="Permalink to this definition">#</a></dt>
<dd><p>Builds a model.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><p><strong>hp</strong> – A <cite>HyperParameters</cite> instance.</p>
</dd>
<dt class="field-even">Returns<span class="colon">:</span></dt>
<dd class="field-even"><p>A model instance.</p>
</dd>
</dl>
</dd></dl>

</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mlgw.NN_model.fit_NN">
<span class="sig-name descname"><span class="pre">fit_NN</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">fit_type</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">in_folder</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">out_folder</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">hyperparameters</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">N_train</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">comp_to_fit</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">features</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">epochs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">2000</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">verbose</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">1</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">residual</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">False</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mlgw/NN_model.html#fit_NN"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlgw.NN_model.fit_NN" title="Permalink to this definition">#</a></dt>
<dd><blockquote>
<div><p>theta = (q,s1,s2) —&gt; PC_pojection(theta)</p>
</div></blockquote>
<dl class="simple">
<dt>Outputs the fitted model to out_folder</dt><dd><p>amp(ph)_PCs.h5 (weights of the model)
feat_amp(ph)_PCs.txt
info.txt</p>
</dd>
</dl>
<p>Furthermore it copies PCA models and times files to the out folder.
Several of these NNs, for both amplitude and phase, can be combined with the NN_gather method (STILL HAEV TO IMPLEMENT!!!), which can then be inputted to mlgw.GW_generator.GW_generator.
User can choose some fitting hyperparameters.
Input:</p>
<blockquote>
<div><p>fit_type (“amp”,”ph”)   whether to fit the model for amplitude or phase
in_folder                               path to folder with the PCA dataset. It must have the format of mlgw.fit_model.create_PCA_dataset
out_folder                              path to folder to save models to. Several folder locations can be inputted to NN_gather which can then be used by mlgw.GW_generator.mode_generator_NN
hyperparameters                 dictionary of the hyperparameters used for the NN structure. If none, default parameters are used.
N_train                                 integer for how many training samples to use. If none, all are used.
comp_to_fit     []                      list of PCs to fit. If None, all components will be fitted. If int, it denotes the maximum PC order to be fitted.
features []                             list of strings for adding features. Note that only features implemented in PcaData_v2.PcaData.augment_features can be used. If None, a default second degree polynomial in q, s1, s2 will be used.
epochs                                  integer specifying for how many iterations (epochs) the NN should train
verbose                                 whether to display NN iteration messages
residual                                whether this is a model for the residual</p>
</div></blockquote>
</dd></dl>

<dl class="py function">
<dt class="sig sig-object py" id="mlgw.NN_model.gather_NN">
<span class="sig-name descname"><span class="pre">gather_NN</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">mode</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">data_location</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">amp_model_locations</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">ph_model_locations</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">out_folder</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mlgw/NN_model.html#gather_NN"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlgw.NN_model.gather_NN" title="Permalink to this definition">#</a></dt>
<dd><dl class="simple">
<dt>This function combines ampltidude and phase models for a specific mode and formats them in a folder inside the out_folder which can then be inputted in the mode_generator class. It assumes the folders in amp_model_locations are formatted as outputted by fit_NN.</dt><dd><p>mode : string “lm” that refers to the mode
amp_model_locations : list of strings containing the model locations for amplitude
ph_model_locations : list of strings containing the model locations for phase
out_folder : string contaning the folder to which combined model should be saved.</p>
</dd>
</dl>
</dd></dl>

<dl class="py class">
<dt class="sig sig-object py" id="mlgw.NN_model.mlgw_NN">
<em class="property"><span class="pre">class</span><span class="w"> </span></em><span class="sig-name descname"><span class="pre">mlgw_NN</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="o"><span class="pre">*</span></span><span class="n"><span class="pre">args</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mlgw/NN_model.html#mlgw_NN"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlgw.NN_model.mlgw_NN" title="Permalink to this definition">#</a></dt>
<dd><p>Creates a <cite>Sequential</cite> model instance.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>layers</strong> – Optional list of layers to add to the model.</p></li>
<li><p><strong>name</strong> – Optional name for the model.</p></li>
</ul>
</dd>
</dl>
<dl class="py method">
<dt class="sig sig-object py" id="mlgw.NN_model.mlgw_NN.fit">
<span class="sig-name descname"><span class="pre">fit</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">y</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">epochs</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">validation_data</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">batch_size</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em>, <em class="sig-param"><span class="n"><span class="pre">callbacks</span></span><span class="o"><span class="pre">=</span></span><span class="default_value"><span class="pre">None</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mlgw/NN_model.html#mlgw_NN.fit"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlgw.NN_model.mlgw_NN.fit" title="Permalink to this definition">#</a></dt>
<dd><p>Trains the model for a fixed number of epochs (dataset iterations).</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> – <p>Input data. It could be:
- A Numpy array (or array-like), or a list of arrays</p>
<blockquote>
<div><p>(in case the model has multiple inputs).</p>
</div></blockquote>
<ul>
<li><p>A TensorFlow tensor, or a list of tensors
(in case the model has multiple inputs).</p></li>
<li><p>A dict mapping input names to the corresponding array/tensors,
if the model has named inputs.</p></li>
<li><p>A <cite>tf.data</cite> dataset. Should return a tuple
of either <cite>(inputs, targets)</cite> or
<cite>(inputs, targets, sample_weights)</cite>.</p></li>
<li><p>A generator or <cite>keras.utils.Sequence</cite> returning <cite>(inputs,
targets)</cite> or <cite>(inputs, targets, sample_weights)</cite>.</p></li>
<li><p>A <cite>tf.keras.utils.experimental.DatasetCreator</cite>, which wraps a
callable that takes a single argument of type
<cite>tf.distribute.InputContext</cite>, and returns a <cite>tf.data.Dataset</cite>.
<cite>DatasetCreator</cite> should be used when users prefer to specify the
per-replica batching and sharding logic for the <cite>Dataset</cite>.
See <cite>tf.keras.utils.experimental.DatasetCreator</cite> doc for more
information.</p></li>
</ul>
<p>A more detailed description of unpacking behavior for iterator
types (Dataset, generator, Sequence) is given below. If these
include <cite>sample_weights</cite> as a third component, note that sample
weighting applies to the <cite>weighted_metrics</cite> argument but not the
<cite>metrics</cite> argument in <cite>compile()</cite>. If using
<cite>tf.distribute.experimental.ParameterServerStrategy</cite>, only
<cite>DatasetCreator</cite> type is supported for <cite>x</cite>.</p>
</p></li>
<li><p><strong>y</strong> – Target data. Like the input data <cite>x</cite>,
it could be either Numpy array(s) or TensorFlow tensor(s).
It should be consistent with <cite>x</cite> (you cannot have Numpy inputs and
tensor targets, or inversely). If <cite>x</cite> is a dataset, generator,
or <cite>keras.utils.Sequence</cite> instance, <cite>y</cite> should
not be specified (since targets will be obtained from <cite>x</cite>).</p></li>
<li><p><strong>batch_size</strong> – Integer or <cite>None</cite>.
Number of samples per gradient update.
If unspecified, <cite>batch_size</cite> will default to 32.
Do not specify the <cite>batch_size</cite> if your data is in the
form of datasets, generators, or <cite>keras.utils.Sequence</cite>
instances (since they generate batches).</p></li>
<li><p><strong>epochs</strong> – Integer. Number of epochs to train the model.
An epoch is an iteration over the entire <cite>x</cite> and <cite>y</cite>
data provided
(unless the <cite>steps_per_epoch</cite> flag is set to
something other than None).
Note that in conjunction with <cite>initial_epoch</cite>,
<cite>epochs</cite> is to be understood as “final epoch”.
The model is not trained for a number of iterations
given by <cite>epochs</cite>, but merely until the epoch
of index <cite>epochs</cite> is reached.</p></li>
<li><p><strong>verbose</strong> – ‘auto’, 0, 1, or 2. Verbosity mode.
0 = silent, 1 = progress bar, 2 = one line per epoch.
‘auto’ defaults to 1 for most cases, but 2 when used with
<cite>ParameterServerStrategy</cite>. Note that the progress bar is not
particularly useful when logged to a file, so verbose=2 is
recommended when not running interactively (eg, in a production
environment).</p></li>
<li><p><strong>callbacks</strong> – List of <cite>keras.callbacks.Callback</cite> instances.
List of callbacks to apply during training.
See <cite>tf.keras.callbacks</cite>. Note
<cite>tf.keras.callbacks.ProgbarLogger</cite> and
<cite>tf.keras.callbacks.History</cite> callbacks are created automatically
and need not be passed into <cite>model.fit</cite>.
<cite>tf.keras.callbacks.ProgbarLogger</cite> is created or not based on
<cite>verbose</cite> argument to <cite>model.fit</cite>.
Callbacks with batch-level calls are currently unsupported with
<cite>tf.distribute.experimental.ParameterServerStrategy</cite>, and users
are advised to implement epoch-level calls instead with an
appropriate <cite>steps_per_epoch</cite> value.</p></li>
<li><p><strong>validation_split</strong> – Float between 0 and 1.
Fraction of the training data to be used as validation data.
The model will set apart this fraction of the training data,
will not train on it, and will evaluate
the loss and any model metrics
on this data at the end of each epoch.
The validation data is selected from the last samples
in the <cite>x</cite> and <cite>y</cite> data provided, before shuffling. This
argument is not supported when <cite>x</cite> is a dataset, generator or
<cite>keras.utils.Sequence</cite> instance.
If both <cite>validation_data</cite> and <cite>validation_split</cite> are provided,
<cite>validation_data</cite> will override <cite>validation_split</cite>.
<cite>validation_split</cite> is not yet supported with
<cite>tf.distribute.experimental.ParameterServerStrategy</cite>.</p></li>
<li><p><strong>validation_data</strong> – <p>Data on which to evaluate
the loss and any model metrics at the end of each epoch.
The model will not be trained on this data. Thus, note the fact
that the validation loss of data provided using
<cite>validation_split</cite> or <cite>validation_data</cite> is not affected by
regularization layers like noise and dropout.
<cite>validation_data</cite> will override <cite>validation_split</cite>.
<cite>validation_data</cite> could be:</p>
<blockquote>
<div><ul>
<li><p>A tuple <cite>(x_val, y_val)</cite> of Numpy arrays or tensors.</p></li>
<li><p>A tuple <cite>(x_val, y_val, val_sample_weights)</cite> of NumPy
arrays.</p></li>
<li><p>A <cite>tf.data.Dataset</cite>.</p></li>
<li><p>A Python generator or <cite>keras.utils.Sequence</cite> returning</p></li>
</ul>
<p><cite>(inputs, targets)</cite> or <cite>(inputs, targets, sample_weights)</cite>.</p>
</div></blockquote>
<p><cite>validation_data</cite> is not yet supported with
<cite>tf.distribute.experimental.ParameterServerStrategy</cite>.</p>
</p></li>
<li><p><strong>shuffle</strong> – Boolean (whether to shuffle the training data
before each epoch) or str (for ‘batch’). This argument is
ignored when <cite>x</cite> is a generator or an object of tf.data.Dataset.
‘batch’ is a special option for dealing
with the limitations of HDF5 data; it shuffles in batch-sized
chunks. Has no effect when <cite>steps_per_epoch</cite> is not <cite>None</cite>.</p></li>
<li><p><strong>class_weight</strong> – Optional dictionary mapping class indices (integers)
to a weight (float) value, used for weighting the loss function
(during training only).
This can be useful to tell the model to
“pay more attention” to samples from
an under-represented class.</p></li>
<li><p><strong>sample_weight</strong> – Optional Numpy array of weights for
the training samples, used for weighting the loss function
(during training only). You can either pass a flat (1D)
Numpy array with the same length as the input samples
(1:1 mapping between weights and samples),
or in the case of temporal data,
you can pass a 2D array with shape
<cite>(samples, sequence_length)</cite>,
to apply a different weight to every timestep of every sample.
This argument is not supported when <cite>x</cite> is a dataset, generator,
or <cite>keras.utils.Sequence</cite> instance, instead provide the
sample_weights as the third element of <cite>x</cite>.
Note that sample weighting does not apply to metrics specified
via the <cite>metrics</cite> argument in <cite>compile()</cite>. To apply sample
weighting to your metrics, you can specify them via the
<cite>weighted_metrics</cite> in <cite>compile()</cite> instead.</p></li>
<li><p><strong>initial_epoch</strong> – Integer.
Epoch at which to start training
(useful for resuming a previous training run).</p></li>
<li><p><strong>steps_per_epoch</strong> – <p>Integer or <cite>None</cite>.
Total number of steps (batches of samples)
before declaring one epoch finished and starting the
next epoch. When training with input tensors such as
TensorFlow data tensors, the default <cite>None</cite> is equal to
the number of samples in your dataset divided by
the batch size, or 1 if that cannot be determined. If x is a
<cite>tf.data</cite> dataset, and ‘steps_per_epoch’
is None, the epoch will run until the input dataset is
exhausted.  When passing an infinitely repeating dataset, you
must specify the <cite>steps_per_epoch</cite> argument. If
<cite>steps_per_epoch=-1</cite> the training will run indefinitely with an
infinitely repeating dataset.  This argument is not supported
with array inputs.
When using <cite>tf.distribute.experimental.ParameterServerStrategy</cite>:</p>
<blockquote>
<div><ul>
<li><p><cite>steps_per_epoch=None</cite> is not supported.</p></li>
</ul>
</div></blockquote>
</p></li>
<li><p><strong>validation_steps</strong> – Only relevant if <cite>validation_data</cite> is provided and
is a <cite>tf.data</cite> dataset. Total number of steps (batches of
samples) to draw before stopping when performing validation
at the end of every epoch. If ‘validation_steps’ is None,
validation will run until the <cite>validation_data</cite> dataset is
exhausted. In the case of an infinitely repeated dataset, it
will run into an infinite loop. If ‘validation_steps’ is
specified and only part of the dataset will be consumed, the
evaluation will start from the beginning of the dataset at each
epoch. This ensures that the same validation samples are used
every time.</p></li>
<li><p><strong>validation_batch_size</strong> – Integer or <cite>None</cite>.
Number of samples per validation batch.
If unspecified, will default to <cite>batch_size</cite>.
Do not specify the <cite>validation_batch_size</cite> if your data is in
the form of datasets, generators, or <cite>keras.utils.Sequence</cite>
instances (since they generate batches).</p></li>
<li><p><strong>validation_freq</strong> – Only relevant if validation data is provided.
Integer or <cite>collections.abc.Container</cite> instance (e.g. list, tuple,
etc.).  If an integer, specifies how many training epochs to run
before a new validation run is performed, e.g. <cite>validation_freq=2</cite>
runs validation every 2 epochs. If a Container, specifies the
epochs on which to run validation, e.g.
<cite>validation_freq=[1, 2, 10]</cite> runs validation at the end of the
1st, 2nd, and 10th epochs.</p></li>
<li><p><strong>max_queue_size</strong> – Integer. Used for generator or
<cite>keras.utils.Sequence</cite> input only. Maximum size for the generator
queue.  If unspecified, <cite>max_queue_size</cite> will default to 10.</p></li>
<li><p><strong>workers</strong> – Integer. Used for generator or <cite>keras.utils.Sequence</cite> input
only. Maximum number of processes to spin up
when using process-based threading. If unspecified, <cite>workers</cite>
will default to 1.</p></li>
<li><p><strong>use_multiprocessing</strong> – Boolean. Used for generator or
<cite>keras.utils.Sequence</cite> input only. If <cite>True</cite>, use process-based
threading. If unspecified, <cite>use_multiprocessing</cite> will default to
<cite>False</cite>. Note that because this implementation relies on
multiprocessing, you should not pass non-picklable arguments to
the generator as they can’t be passed easily to children
processes.</p></li>
</ul>
</dd>
</dl>
<dl>
<dt>Unpacking behavior for iterator-like inputs:</dt><dd><blockquote>
<div><p>A common pattern is to pass a tf.data.Dataset, generator, or</p>
</div></blockquote>
<p>tf.keras.utils.Sequence to the <cite>x</cite> argument of fit, which will in fact
yield not only features (x) but optionally targets (y) and sample
weights.  Keras requires that the output of such iterator-likes be
unambiguous. The iterator should return a tuple of length 1, 2, or 3,
where the optional second and third elements will be used for y and
sample_weight respectively. Any other type provided will be wrapped in
a length one tuple, effectively treating everything as ‘x’. When
yielding dicts, they should still adhere to the top-level tuple
structure.
e.g. <cite>({“x0”: x0, “x1”: x1}, y)</cite>. Keras will not attempt to separate
features, targets, and weights from the keys of a single dict.</p>
<blockquote>
<div><p>A notable unsupported data type is the namedtuple. The reason is</p>
</div></blockquote>
<p>that it behaves like both an ordered datatype (tuple) and a mapping
datatype (dict). So given a namedtuple of the form:</p>
<blockquote>
<div><p><cite>namedtuple(“example_tuple”, [“y”, “x”])</cite></p>
</div></blockquote>
<p>it is ambiguous whether to reverse the order of the elements when
interpreting the value. Even worse is a tuple of the form:</p>
<blockquote>
<div><p><cite>namedtuple(“other_tuple”, [“x”, “y”, “z”])</cite></p>
</div></blockquote>
<p>where it is unclear if the tuple was intended to be unpacked into x,
y, and sample_weight or passed through as a single element to <cite>x</cite>. As
a result the data processing code will simply raise a ValueError if it
encounters a namedtuple. (Along with instructions to remedy the
issue.)</p>
</dd>
</dl>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>A <cite>History</cite> object. Its <cite>History.history</cite> attribute is
a record of training loss values and metrics values
at successive epochs, as well as validation loss values
and validation metrics values (if applicable).</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#RuntimeError" title="(in Python v3.11)"><strong>RuntimeError</strong></a> – <ol class="arabic simple">
<li><p>If the model was never compiled or,</p></li>
</ol>
</p></li>
<li><p><strong>2. If model.fit is  wrapped in tf.function.</strong> – </p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ValueError" title="(in Python v3.11)"><strong>ValueError</strong></a> – In case of mismatch between the provided input data
    and what the model expects or when the input data is empty.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

<dl class="py method">
<dt class="sig sig-object py" id="mlgw.NN_model.mlgw_NN.predict">
<span class="sig-name descname"><span class="pre">predict</span></span><span class="sig-paren">(</span><em class="sig-param"><span class="n"><span class="pre">x</span></span></em>, <em class="sig-param"><span class="o"><span class="pre">**</span></span><span class="n"><span class="pre">kwargs</span></span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/mlgw/NN_model.html#mlgw_NN.predict"><span class="viewcode-link"><span class="pre">[source]</span></span></a><a class="headerlink" href="#mlgw.NN_model.mlgw_NN.predict" title="Permalink to this definition">#</a></dt>
<dd><p>Generates output predictions for the input samples.</p>
<p>Computation is done in batches. This method is designed for batch
processing of large numbers of inputs. It is not intended for use inside
of loops that iterate over your data and process small numbers of inputs
at a time.</p>
<p>For small numbers of inputs that fit in one batch,
directly use <cite>__call__()</cite> for faster execution, e.g.,
<cite>model(x)</cite>, or <cite>model(x, training=False)</cite> if you have layers such as
<cite>tf.keras.layers.BatchNormalization</cite> that behave differently during
inference. You may pair the individual model call with a <cite>tf.function</cite>
for additional performance inside your inner loop.
If you need access to numpy array values instead of tensors after your
model call, you can use <cite>tensor.numpy()</cite> to get the numpy array value of
an eager tensor.</p>
<p>Also, note the fact that test loss is not affected by
regularization layers like noise and dropout.</p>
<p>Note: See [this FAQ entry](
<a class="reference external" href="https://keras.io/getting_started/faq/#whats-the-difference-between-model-methods-predict-and-call">https://keras.io/getting_started/faq/#whats-the-difference-between-model-methods-predict-and-call</a>)
for more details about the difference between <cite>Model</cite> methods
<cite>predict()</cite> and <cite>__call__()</cite>.</p>
<dl class="field-list simple">
<dt class="field-odd">Parameters<span class="colon">:</span></dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>x</strong> – <p>Input samples. It could be:
- A Numpy array (or array-like), or a list of arrays</p>
<blockquote>
<div><p>(in case the model has multiple inputs).</p>
</div></blockquote>
<ul>
<li><p>A TensorFlow tensor, or a list of tensors
(in case the model has multiple inputs).</p></li>
<li><p>A <cite>tf.data</cite> dataset.</p></li>
<li><p>A generator or <cite>keras.utils.Sequence</cite> instance.</p></li>
</ul>
<p>A more detailed description of unpacking behavior for iterator
types (Dataset, generator, Sequence) is given in the <cite>Unpacking
behavior for iterator-like inputs</cite> section of <cite>Model.fit</cite>.</p>
</p></li>
<li><p><strong>batch_size</strong> – Integer or <cite>None</cite>.
Number of samples per batch.
If unspecified, <cite>batch_size</cite> will default to 32.
Do not specify the <cite>batch_size</cite> if your data is in the
form of dataset, generators, or <cite>keras.utils.Sequence</cite> instances
(since they generate batches).</p></li>
<li><p><strong>verbose</strong> – <cite>“auto”</cite>, 0, 1, or 2. Verbosity mode.
0 = silent, 1 = progress bar, 2 = single line.
<cite>“auto”</cite> defaults to 1 for most cases, and to 2 when used with
<cite>ParameterServerStrategy</cite>. Note that the progress bar is not
particularly useful when logged to a file, so <cite>verbose=2</cite> is
recommended when not running interactively (e.g. in a production
environment).</p></li>
<li><p><strong>steps</strong> – Total number of steps (batches of samples)
before declaring the prediction round finished.
Ignored with the default value of <cite>None</cite>. If x is a <cite>tf.data</cite>
dataset and <cite>steps</cite> is None, <cite>predict()</cite> will
run until the input dataset is exhausted.</p></li>
<li><p><strong>callbacks</strong> – List of <cite>keras.callbacks.Callback</cite> instances.
List of callbacks to apply during prediction.
See [callbacks](
<a class="reference external" href="https://www.tensorflow.org/api_docs/python/tf/keras/callbacks">https://www.tensorflow.org/api_docs/python/tf/keras/callbacks</a>).</p></li>
<li><p><strong>max_queue_size</strong> – Integer. Used for generator or
<cite>keras.utils.Sequence</cite> input only. Maximum size for the
generator queue. If unspecified, <cite>max_queue_size</cite> will default
to 10.</p></li>
<li><p><strong>workers</strong> – Integer. Used for generator or <cite>keras.utils.Sequence</cite> input
only. Maximum number of processes to spin up when using
process-based threading. If unspecified, <cite>workers</cite> will default
to 1.</p></li>
<li><p><strong>use_multiprocessing</strong> – Boolean. Used for generator or
<cite>keras.utils.Sequence</cite> input only. If <cite>True</cite>, use process-based
threading. If unspecified, <cite>use_multiprocessing</cite> will default to
<cite>False</cite>. Note that because this implementation relies on
multiprocessing, you should not pass non-picklable arguments to
the generator as they can’t be passed easily to children
processes.</p></li>
</ul>
</dd>
</dl>
<p>See the discussion of <cite>Unpacking behavior for iterator-like inputs</cite> for
<cite>Model.fit</cite>. Note that Model.predict uses the same interpretation rules
as <cite>Model.fit</cite> and <cite>Model.evaluate</cite>, so inputs must be unambiguous for
all three methods.</p>
<dl class="field-list simple">
<dt class="field-odd">Returns<span class="colon">:</span></dt>
<dd class="field-odd"><p>Numpy array(s) of predictions.</p>
</dd>
<dt class="field-even">Raises<span class="colon">:</span></dt>
<dd class="field-even"><ul class="simple">
<li><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#RuntimeError" title="(in Python v3.11)"><strong>RuntimeError</strong></a> – If <cite>model.predict</cite> is wrapped in a <cite>tf.function</cite>.</p></li>
<li><p><a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ValueError" title="(in Python v3.11)"><strong>ValueError</strong></a> – In case of mismatch between the provided
    input data and the model’s expectations,
    or in case a stateful model receives a number of samples
    that is not a multiple of the batch size.</p></li>
</ul>
</dd>
</dl>
</dd></dl>

</dd></dl>



                </article>
              

              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="GW_generator.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Module GW_generator.py</p>
      </div>
    </a>
    <a class="right-next"
       href="EM_MoE.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Module EM_MoE.py</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Stefano Schmidt
</p>

  </div>
  
  <div class="footer-item">
    
  <p class="copyright">
    
      © Copyright 2023, Stefano Schmidt.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>